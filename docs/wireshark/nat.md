# Wireshark实验：探究NAT (Page240)

1. 客户端的 IP 地址是多少？

192.168.1.100

2. 略

3. 请选择在 7.109267 s 时间的客户端发送到 Google 服务器（其 IP 地址为 IP 地 址 64.233.169.104）的 HTTP GET。承载此 HTTP GET 的 IP 数据报上的源
IP 地址和目标 IP 地址以及 TCP 源和目标端口是什么？

源 IP 192.168.1.100 端口 4335
目的 IP 64.233.169.104 端口 80

4. 什么时候从 Google 服务器收到相应的状态码 200、状态 OK 的 HTTP 响应消息？ 携带状态码 200、状态 OK 的 HTTP 响应消息的 IP 数据报上的源和目标 IP 地址以及 TCP 源和目标端口是什么？

时间 7.158797 s 
源 IP 64.233.169.104 端口 80 
目的 IP 192.168.1.100 端口 4335

5. 回想一下，在将 GET 请求发送到 HTTP 服务器之前，TCP 必须首先使用三次
SYN/ACK 消息建立连接。在什么时间客户端发送了含有 TCP SYN 的报文建立连
接消息用于发送在 7.109267 s 的 GET 请求？TCP SYN 报文的源 IP 地址和目标 IP
地址以及源端口和目标端口是什么？ 为响应 SYN 报文而发送的 ACK 报文的源和
目标 IP 地址以及源和目标端口是什么？在客户端收到此 ACK 报文什么时间？（注
意您需要清除在第 2 题中的过滤器表达式并且输入“tcp”（不含引号）表达式，仅仅
显示 tcp 报文消息。

SYN 报文 
时间：7.075657 s 
源 IP 192.168.1.100 端口 4335 
目的 IP 64.233.169.104 端口 80 
SYN ACK 报文 
时间：7.108986 s 
源 IP 64.233.169.104 端口 80 
目的 IP 192.168.1.100 端口 4335

6. 在 NAT_ISP_side 跟踪文件中，找到跟刚才客户端 7.109267s 同样目的地发
送的 HTTP GET 消息（这个时间是在 NAT_home_side 跟踪文件中记录的时
间）。该消息何时出现在 NAT_ISP_side 跟踪文件中？ 承载此 HTTP GET 消
息的 IP 数据报的源和目标 IP 地址以及 TCP 源和目标端口是什么？与您对上
述问题 3 的回答相比，哪些字段相同，哪些字段不同？

出现时间：6.069168 s 
源 IP 71.192.34.104 端口 4335 
 目的 IP 64.233.169.104 端口 80 
比对除 TCP 校验码以外未见承载的 TCP 报文有何不同

7. HTTP GET 消息中的任何字段是否已更改？ 携带 HTTP GET 的 IP 数据报中
的以下哪个字段发生了变化：版本，标题长度，标志，校验和。 如果这些
字段中的任何一个发生了变化，请说明为什么。

比对未发现 HTTP GET 消息字段更改。
但是在 IP 封包中生存时间，校验和，发送源 IP 均已更改。
因为 NAT 路由会接收该网域的客户端 PC 流量，解包处理 IP 封包，并且进行 TTL-1
（经过每个路由器生存时间-1，当为 0 时被舍弃），且重新计算校验和并且以自己
源头重新封包进行转发。

8. 在 NAT_ISP_side 跟踪文件中，从 Google 服务器收到的第一条 HTTP200 OK
消息在什么时间？ 携带此 HTTP 200 OK 消息的 IP 数据报上的源和目标 IP
地址以及 TCP 源和目标端口是什么？ 与您第 4 问回答的 NAT_home_side 结
果相比哪些字段相同，哪些字段不同？

6.117570
源 IP 64.233.169.104 端口 80 
目的 IP 71.192.34.104 端口 4335

9. 在 NAT_ISP_side 跟踪文件中，跟上面的问题 5 相同地址的客户端到服务器
TCP SYN 报文和服务器到客户端 TCP ACK 报文在什么时间出现？这两个段
的源和目标 IP 地址以及源和目标端口是什么？ 与您的问题 5 相比，哪些字
段相同，哪些字段与不同？

SYN 报文 
时间：6.035475 s 
源 IP 71.192.34.104 端口 4335 
目的 IP 64.233.169.104 端口 80 
SYN ACK 报文
时间：6.06775 s 
源 IP 64.233.169.104 端口 80 
目的 IP 71.192.34.104 端口 4335 
比对除 TCP 校验码以外未见承载的 TCP 报文有何不同 
除此以外 IP 封包不同，原因请见上一题。
总结：NAT 转换更改 TCP 报校验码
IP 封包的生存时间，校验和，发送源 IP。

10. 使用您的第 1 到 8 题的答案，做出跟课本类似的 HTTP 连接的 NAT 转换表。

WAN 端 ：71.192.34.104,4335
LAN 端 ： 192.168.1.100,4335
