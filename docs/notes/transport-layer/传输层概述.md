# 传输层概述

## 传输服务和协议

为运行在不同主机上的应用进程提供逻辑通信

* 传输协议运行在端系统
  * 发送方：将应用层的报文分成报文段，然后传递给网络层
  * 接收方：将报文段重组成报文，然后传递给应用层

* 有多个传输层协议可供应用选择
  * Internet: TCP和UDP

## Internet传输层协议

* 可靠的、保序的传输： TCP
  * 多路复用、解复用
  * 拥塞控制
  * 流量控制
  * 建立连接

* 不可靠、不保序的传输：UDP
  * 多路复用、解复用
  * 没有为尽力而为的IP服务添加更多的其它额外服务

* 都不提供的服务
  * 延时保证
  * 带宽保证


## 多路复用/解复用

发送方：

从多个套接字接收来自多个进程的
报文，根据套接字对应的IP地址和
端口号等信息对报文段用头部加以
封装 (该头部信息用于以后的解复用)

接收方：

根据报文段的头部信息中的IP地址
和端口号将接收到的报文段发给
正确的套接字(和对应的应用进程)

#### 无连接(UDP)多路解复用

udp数据报包括 MSS socket(本机IP，本机端口)  对方主机IP 端口

在接收端，UDP套接字用二元组标识 (目标IP地址、目标端口号)

当主机收到UDP报文段： 
  检查报文段的目标端口号 
  用该端口号将报文段定位给套接字

如果两个不同源IP地址/源端口号的数据报，但是有相同的目标IP地址和端口号，则被定位到相同的套接字


#### 面向连接(TCP)的多路复用

* TCP套接字:四元组本地标识：
  * 源IP地址
  * 源端口号
  * 目的IP地址
  * 目的端口号

* 解复用：接收主机用这四个值来将数据报定位到合适的套接字，给应用层

服务器能够在一个 TCP 端口上同时支持多个TCP套接字：
每个套接字由其四元组标识（有不同的源IP和源PORT）

* Web服务器对每个连接客户端有不同的套接字
  * 非持久对每个请求有不同的套接字